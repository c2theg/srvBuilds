##########################################################################################
#       Christopher Gray
#       christophermjgray@gmail.com
#       https://raw.githubusercontent.com/c2theg/srvBuilds/master/configs/site1_80443.conf
#
#       Initial:  7-21-08 (v 0.6)
#       Updated:  8-15-19  (v 1.17.2)
#       version   6.2.8
##########################################################################################
server {
    if ($host = site1.com) {
        return 301 https://$host$request_uri;
    }
    server_name  *.site1.com site1.com;
    listen  80;
    listen  [::]:80;
    return 404;
}

server {    
    server_name  site1.com;
    root         /media/data/sync;

    error_log    /var/log/nginx/error_site1.log warn;
    access_log   /var/log/nginx/access_site1.log json_access if=$loggable;
    #------- Custom site config -----
    #client_max_body_size     10M;
 
    #---------------------------------------------------------------------------
    #--------------------- SSL / TLS -------------------------------------------
    #--------------------------------------------------------------------------- 
    #listen   443 ssl http2;  # -- Most LB's do not currently support http2
    ##listen   [::]:443 ssl http2 ipv6only=on;   #-- Might have issues with this

    #---- HTTP2 - Server Push --------------------------------------------------
    #http2_push_preload on;
    #http2_push /include/css/main.css;

    #----- TLS Files (Choose only one set) -------------------------------------
    #ssl_certificate          /opt/ssl/$host/server.crt;
    #ssl_certificate_key      /opt/ssl/$host/server.key;
    #ssl_dhparam              /opt/ssl/$host/server.pem;
    #ssl_trusted_certificate /etc/letsencrypt/live/www.domain.com/fullchain.pem;

    #--- Let's Encrypt => managed by Certbot ------
    #ssl_certificate        /etc/letsencrypt/live/$host/fullchain.pem;
    #ssl_certificate_key    /etc/letsencrypyt/live/$host/privkey.pem;
    #ssl_dhparam            /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot    
    #--- End Let's Encrypt -----
    #add_header Public-Key-Pins 'pin-sha256="<HASH_GOES_HERE>"; pin-sha256="<SECOND_HASH_HERE>";
    #include /etc/nginx/snippets/nginx_global_tls.conf;
    
    #------------ Global Configs ----------------------------------------------
    include /etc/nginx/snippets/nginx_global_security.conf;
    include /etc/nginx/snippets/nginx_global_filetypes.conf;
    
    #--------------- Logging ----------------
    # http://nginx.org/en/docs/http/ngx_http_log_module.html#access_log
    #include /etc/nginx/snippets/nginx_global_logging.conf;  
    open_log_file_cache max=1000 inactive=20s valid=1m min_uses=2;
    #--- Logging examples. LOG in each virtual Server level, not here at a global level ---
    #error_log   /var/log/nginx/error_${host}.log warn;
    #access_log  /var/log/nginx/access_${host}.log json_access if=$loggable;
    #-- remote logging --  https://nginx.org/en/docs/syslog.html
    #error_log syslog:server=192.168.1.1:1514,facility=local7,tag=nginx-error-${host},severity=info,nohostname warn;
    #access_log syslog:server=[2001:db8::1]:1514,facility=local7,tag=nginx-access-${host},severity=info,nohostname json_access if=$loggable;   
}
