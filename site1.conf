server {
    listen   80; ## listen for ipv4; this line is default and implied
    listen   [::]:80 default ipv6only=on; ## listen for ipv6

    server_name localhost 127.0.0.1;
    root  /var/www;
    
    access_log  /var/log/nginx/nginx_access.log  main;
    error_log  /var/log/nginx/nginx_error.log warn;
    #--------------------------------------------------------------------------
    index index.php index.html index.htm;
    
    large_client_header_buffers 4 32k;
    location / {
            try_files $uri $uri/ /index.html;
    }

    location /doc/ {
            alias /usr/share/doc/;
            autoindex on;
            allow 127.0.0.1;
            deny all;
    }

    #error_page 404 /404.html;
    # --- redirect server error pages to the static page /50x.html
    #error_page 500 502 503 504 /50x.html;
    #location = /50x.html {
    #       root /usr/share/nginx/www;
    #}

    location ~ \.php$ {
        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        # NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini

        fastcgi_pass    unix:/var/run/php/php7.0-fpm.sock;
        #fastcgi_pass   unix:/var/run/php7.0-fpm.sock;
        #fastcgi_pass   unix:/var/run/php5-fpm.sock;
        #fastcgi_pass   unix:/tmp/php5-fpm.sock;
        #fastcgi_pass   127.0.0.1:9000;

        fastcgi_index   index.php;
        include         fastcgi_params;
        fastcgi_param   SCRIPT_FILENAME     $document_root$fastcgi_script_name;
        fastcgi_param   SCRIPT_NAME         $fastcgi_script_name;

        #fastcgi_param  REMOTE_ADDR         $http_x_forwarded_for;
        #fastcgi_param  REMOTE_ADDR         $http_x_real_ip;
        #fastcgi_param  REMOTE_ADDR         $http_x_forwarded_for;

        ##---  Fixes the ability to forward ip address to PHP ---
        set_real_ip_from 127.0.0.1/32; 
        real_ip_header X-Forwarded-For;
        ##---------------------------------------------------------------------
        fastcgi_connect_timeout         60;
        fastcgi_send_timeout            60;
        fastcgi_read_timeout            60;
        fastcgi_buffer_size             4k;
        fastcgi_buffers                 512 4k;
        fastcgi_busy_buffers_size       8k;
        fastcgi_temp_file_write_size    256k;
        # ----- Caching -----
        expires 300s;
        add_header Pragma "public";
        add_header Cache-Control "max-age=300, public, must-revalidate, proxy-revalidate";
        add_header X-Powered-By "Perimeter Defense and a few unicorn tears";
        uwsgi_param HTTP_IF_NONE_MATCH $http_if_none_match;
        uwsgi_param HTTP_IF_MODIFIED_SINCE $http_if_modified_since;
    }

    location ~* \.(js)$ {
        expires 600s;
        add_header Pragma "public";
        add_header Cache-Control "max-age=600, public, must-revalidate, proxy-revalidate";
        add_header X-Powered-By "Unicorn Tears";
        access_log  off;
        log_not_found  off;
        uwsgi_param HTTP_IF_NONE_MATCH $http_if_none_match;
        uwsgi_param HTTP_IF_MODIFIED_SINCE $http_if_modified_since;
    }

    location ~* \.(css|html|htm)$ {
        expires 7200s;
        add_header Pragma "public";
        add_header Cache-Control "max-age=7200, public, must-revalidate, proxy-revalidate";
        add_header X-Powered-By "Unicorn Tears";
        access_log  off;
        log_not_found  off;
        uwsgi_param HTTP_IF_NONE_MATCH $http_if_none_match;
        uwsgi_param HTTP_IF_MODIFIED_SINCE $http_if_modified_since;
    }

    location ~* \.(3gp|gif|jpg|jpeg|png|ico|wmv|avi|asf|asx|mpg|mpeg|mp4|pls|mp3|mid|wav|swf|flv|ogg|woff|woff2)$ {
        expires 604800s; # a week
        add_header Pragma "public";
        add_header Cache-Control "max-age=604800, public, must-revalidate, proxy-revalidate";
        add_header X-Powered-By "Unicorn Tears";
        access_log  off;
        log_not_found off;
        uwsgi_param HTTP_IF_NONE_MATCH $http_if_none_match;
        uwsgi_param HTTP_IF_MODIFIED_SINCE $http_if_modified_since;
    }

    location ~ /\.ht { deny all; access_log off; log_not_found off; }

}
